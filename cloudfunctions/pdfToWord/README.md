# PDF转Word功能

## 📝 功能说明

这是一个为微信小程序开发的PDF转Word转换工具，可以将PDF文档转换为可编辑的Word文档。

## ✨ 功能特点

### 核心功能
1. **文本提取** - 准确提取PDF中的文字内容
2. **格式保留** - 尽可能保留段落、标题等格式
3. **分页保留** - 可选择保留原PDF的分页结构
4. **云端处理** - 使用云函数进行转换，性能稳定

### 技术优势
- 支持标准文本型PDF
- 智能识别标题和段落
- 自动格式化Word文档
- 支持大文件处理（最大20MB）

### 转换选项
- **保留格式** - 尝试保留原文档格式
- **保留分页符** - 在原分页位置插入分页符

## 📂 文件结构

### 云函数
```
cloudfunctions/pdfToWord/
├── config.json       # 云函数配置
├── index.js          # 云函数核心逻辑
└── package.json      # 依赖包配置
```

### 前端页面
```
miniprogram/pages/pdf-to-word/
├── pdf-to-word.js    # 页面逻辑
├── pdf-to-word.json  # 页面配置
├── pdf-to-word.wxml  # 页面结构
└── pdf-to-word.wxss  # 页面样式
```

## 🔧 技术实现

### 云函数依赖

```json
{
  "wx-server-sdk": "~2.6.3",
  "pdf-parse": "^1.1.1",      // PDF文本提取
  "docx": "^8.5.0",           // Word文档生成
  "pdf-lib": "^1.17.1"        // PDF基础信息读取
}
```

### 核心技术栈

#### 1. PDF处理
- **pdf-lib** - 读取PDF基本信息（页数等）
- **pdf-parse** - 提取PDF文本内容

#### 2. Word生成
- **docx** - 创建和格式化Word文档
  - 段落处理
  - 标题识别
  - 分页符插入
  - 样式设置

#### 3. 云开发功能
- **文件下载** - `cloud.downloadFile()`
- **文件上传** - `cloud.uploadFile()`
- **云函数调用** - `wx.cloud.callFunction()`

### 转换流程

```
用户选择PDF → 上传到云存储 → 调用云函数
         ↓
云函数下载PDF → 提取文本 → 分析格式
         ↓
生成Word文档 → 上传云存储 → 返回文件ID
         ↓
前端获取文件 → 打开/保存/分享
```

### 核心算法

#### 1. 文本提取
```javascript
const pdfData = await pdfParse(pdfBuffer);
const textContent = pdfData.text;
const totalPages = pdfData.numpages;
```

#### 2. 段落识别
```javascript
// 按双换行符分割段落
const rawParagraphs = textContent.split(/\n\n+/);

// 识别标题（短行、大写开头、不以句号结尾）
const isHeading = text.length < 100 && 
                  /^[A-Z0-9第一二三四五六七八九十\d]+/.test(text) &&
                  !text.endsWith('。');
```

#### 3. Word文档生成
```javascript
const doc = new Document({
  sections: [{
    properties: { /* 页面设置 */ },
    children: [
      new Paragraph({ text: '标题', heading: HeadingLevel.HEADING_1 }),
      new Paragraph({ text: '正文段落' })
    ]
  }]
});
```

## 🚀 部署指南

### 1. 安装云函数依赖

```bash
cd cloudfunctions/pdfToWord
npm install
```

### 2. 上传云函数

在微信开发者工具中：
1. 右键点击 `pdfToWord` 文件夹
2. 选择"上传并部署：云端安装依赖"
3. 等待部署完成

### 3. 配置云环境

确保在 `app.js` 中初始化云开发：
```javascript
wx.cloud.init({
  env: 'your-env-id',
  traceUser: true
});
```

### 4. 测试功能

1. 打开小程序
2. 进入"PDF转Word"页面
3. 选择一个文本型PDF文件
4. 点击"开始转换"
5. 等待转换完成并打开Word文档

## 📱 使用说明

### 用户操作步骤

1. **选择PDF文件**
   - 点击"选择PDF文件"按钮
   - 从聊天记录或文件中选择PDF
   - 支持最大20MB的文件

2. **配置转换选项**
   - 保留格式：尝试保留原文档格式
   - 保留分页符：在原分页位置插入分页符

3. **开始转换**
   - 点击"开始转换为Word"按钮
   - 等待云端处理

4. **获取结果**
   - 转换完成后可以打开文档预览
   - 支持保存到本地
   - 支持分享给好友

### 支持的PDF类型

✅ **支持**
- 文本型PDF（可选择和复制文字的PDF）
- 标准排版的文档PDF
- 电子书、报告、论文等

❌ **暂不支持**
- 扫描版PDF（图片PDF，需要OCR）
- 加密或受保护的PDF
- 复杂表格和图形为主的PDF

## ⚠️ 重要说明

### 转换限制

1. **有损转换**
   - PDF转Word是有损转换
   - 主要提取文本内容
   - 复杂排版可能无法完美还原

2. **不支持的内容**
   - 图片（暂不提取）
   - 复杂表格
   - 图形和矢量图
   - 特殊字体效果

3. **格式保留**
   - 基本段落格式可以保留
   - 标题会被识别
   - 简单的文档结构可以还原
   - 页边距使用标准设置

### 错误处理

常见错误及解决方案：

| 错误信息 | 原因 | 解决方案 |
|---------|------|---------|
| 未找到可提取的文本 | 扫描版PDF | 使用OCR工具先识别文字 |
| 文件过大 | 超过20MB限制 | 压缩PDF或拆分后转换 |
| 转换超时 | 文件太大或复杂 | 尝试较小的PDF文件 |
| 上传失败 | 网络问题 | 检查网络连接 |

## 🎨 UI/UX 设计

### 设计特点
- **渐变背景** - 紫色渐变增强视觉效果
- **卡片式布局** - 清晰的信息层次
- **图标辅助** - Emoji图标增强可读性
- **状态反馈** - Loading和Toast提示
- **详细说明** - 转换说明和使用步骤

### 交互流程
1. 文件选择 → 显示文件信息
2. 配置选项 → 实时开关
3. 开始转换 → 进度提示
4. 转换完成 → 操作选项（打开/保存/分享）

## 📊 性能优化

### 云函数优化
- 使用 Buffer 处理文件，避免大文件内存问题
- 异步处理所有 I/O 操作
- 及时清理临时文件

### 前端优化
- 文件大小限制（20MB）
- 上传前验证文件格式
- 显示详细的进度提示
- 错误信息友好提示

## 🔐 安全性

### 数据安全
- 所有文件上传加密传输
- 云存储自动权限控制
- 不保存用户敏感信息
- 临时文件自动清理

### 权限控制
- 云函数仅当前环境可访问
- 文件访问需要有效的fileID
- 临时链接有时效性

## 🐛 已知问题

1. **图片不支持** - 当前版本不提取PDF中的图片
2. **表格识别** - 复杂表格可能识别为普通文本
3. **格式还原** - 部分特殊格式无法完全还原

## 🔄 未来优化方向

1. **图片提取** - 提取并插入PDF中的图片
2. **表格识别** - 识别并生成Word表格
3. **OCR支持** - 支持扫描版PDF转换
4. **批量转换** - 支持多个PDF同时转换
5. **格式增强** - 更好的格式识别和还原
6. **预览功能** - 转换前预览提取的内容
7. **自定义选项** - 更多转换参数配置

## 📝 开发日志

- **2026-02-16** - 初始版本开发完成
  - 实现基础PDF文本提取
  - 实现Word文档生成
  - 完成前端页面开发
  - 完成云函数部署

## 👥 贡献者

GitHub Copilot (Claude Sonnet 4.5)

## 📄 许可证

与主项目保持一致

---

**最后更新**: 2026年2月16日
