<!--pages/tools/video-compress/index.wxml-->
<wxs module="utils">
var formatPercent = function(value) {
  return Math.round(value);
};
module.exports = {
  formatPercent: formatPercent
};
</wxs>

<view class="container">

  <!-- é¡¶éƒ¨æ“ä½œåŒº -->
  <view class="action-section">
    <button class="choose-btn" bindtap="chooseVideos">
      <text class="icon">ğŸ¬</text>
      <text>é€‰æ‹©è§†é¢‘</text>
    </button>
    <text class="video-count">å·²é€‰æ‹© {{videos.length}} ä¸ª</text>
  </view>

  <!-- å‹ç¼©è®¾ç½® -->
  <view class="settings-section">
    <view class="section-title">ğŸšï¸ å‹ç¼©è®¾ç½®</view>

    <!-- è´¨é‡é¢„è®¾æŒ‰é’® -->
    <view class="setting-item">
      <view class="setting-label">
        <text>å‹ç¼©è´¨é‡</text>
      </view>

      <!-- è´¨é‡é¢„è®¾æŒ‰é’® -->
      <view class="preset-buttons">
        <block wx:for="{{qualityPresets}}" wx:key="value">
          <button
            size="mini"
            class="preset-btn {{quality === item.value ? 'active' : ''}}"
            data-quality="{{item.value}}"
            bindtap="selectQualityPreset"
          >
            <text>{{item.icon}} {{item.label}}</text>
          </button>
        </block>
      </view>
    </view>

    <!-- åˆ†è¾¨ç‡é€‰é¡¹ -->
    <view class="setting-item">
      <view class="setting-label">
        <text>åˆ†è¾¨ç‡</text>
      </view>
      <picker
        mode="selector"
        range="{{resolutionOptions}}"
        range-key="label"
        value="{{resolutionIndex}}"
        bindchange="onResolutionChange"
      >
        <view class="picker">
          <text>{{resolutionOptions[resolutionIndex].label}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
    </view>

    <!-- ç ç‡é€‰é¡¹ -->
    <view class="setting-item">
      <view class="setting-label">
        <text>ç ç‡</text>
      </view>
      <picker
        mode="selector"
        range="{{bitrateOptions}}"
        range-key="label"
        value="{{bitrateIndex}}"
        bindchange="onBitrateChange"
      >
        <view class="picker">
          <text>{{bitrateOptions[bitrateIndex].icon}} {{bitrateOptions[bitrateIndex].label}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
    </view>

    <!-- ç»Ÿè®¡ä¿¡æ¯ -->
    <view class="stats" wx:if="{{totalCompressedSize > 0}}">
      <view class="stat-item">
        <text class="stat-label">æ€»è®¡å‹ç¼©:</text>
        <text class="stat-value">{{overallRatio}}%</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">åŸå§‹å¤§å°:</text>
        <text class="stat-value">{{formatSize(totalOriginalSize)}}</text>
      </view>
      <view class="stat-item">
        <text class="stat-label">å‹ç¼©å:</text>
        <text class="stat-value">{{formatSize(totalCompressedSize)}}</text>
      </view>
    </view>
  </view>

  <!-- è§†é¢‘åˆ—è¡¨ -->
  <view class="videos-section" wx:if="{{videos.length > 0}}">
    <view class="videos-header">
      <text class="videos-title">è§†é¢‘åˆ—è¡¨</text>
    </view>

    <scroll-view scroll-y class="videos-scroll">
      <block wx:for="{{videos}}" wx:key="index">
        <view class="video-card">
          <view class="preview-wrapper">
            <image
              class="preview"
              src="{{item.thumbPath || '/images/video-placeholder.png'}}"
              mode="aspectFill"
            />
            <text class="duration-badge">{{item.durationText}}</text>
          </view>

          <view class="video-info">
            <view class="size-info">
              <text class="original-size">{{formatSize(item.originalSize)}}</text>
              <text class="arrow" wx:if="{{item.compressedSize}}">â†’</text>
              <text class="compressed-size" wx:if="{{item.compressedSize}}">
                {{formatSize(item.compressedSize)}}
              </text>
            </view>

            <view class="dimension-info">
              <text class="dimension">{{item.width}}Ã—{{item.height}}</text>
            </view>

            <view class="ratio-badge" wx:if="{{item.ratio}}">
              <text class="badge">-{{item.ratio}}%</text>
            </view>
          </view>

          <view class="video-actions">
            <button
              wx:if="{{item.compressedFileID}}"
              size="mini"
              class="save-btn"
              bindtap="saveSingleVideo"
              data-index="{{index}}"
            >
              ä¿å­˜
            </button>
            <button
              size="mini"
              class="delete-btn"
              bindtap="deleteVideo"
              data-index="{{index}}"
            >
              åˆ é™¤
            </button>
          </view>
        </view>
      </block>
    </scroll-view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:else>
    <text class="empty-emoji">ğŸï¸</text>
    <text class="empty-tip">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®é€‰æ‹©è§†é¢‘</text>
    <text class="empty-desc">æ”¯æŒä¸€æ¬¡é€‰æ‹©æœ€å¤š3ä¸ªè§†é¢‘ï¼Œå•ä¸ªä¸è¶…è¿‡100MB</text>
  </view>

  <!-- åº•éƒ¨æ“ä½œæŒ‰é’® -->
  <view class="bottom-actions" wx:if="{{videos.length > 0}}">
    <button
      class="compress-btn"
      bindtap="startCompress"
      disabled="{{isCompressing}}"
      loading="{{isCompressing}}"
    >
      {{isCompressing ? 'å‹ç¼©ä¸­ ' + compressProgress + '%' : 'å¼€å§‹å‹ç¼©'}}
    </button>

    <button
      class="save-all-btn"
      bindtap="saveAllToAlbum"
      disabled="{{totalCompressedSize === 0}}"
    >
      ä¿å­˜å…¨éƒ¨
    </button>
  </view>

</view>
