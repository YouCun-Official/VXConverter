<!--pages/tools/pdf-split/index.wxml-->
<wxs module="utils">
  var formatSize = function(bytes) {
    if (bytes === 0) return '0 B';
    var k = 1024;
    var sizes = ['B', 'KB', 'MB', 'GB'];
    var i = Math.floor(Math.log(bytes) / Math.log(k));
    return (bytes / Math.pow(k, i)).toFixed(2) + ' ' + sizes[i];
  };

  module.exports = {
    formatSize: formatSize
  };
</wxs>

<view class="container">

  <!-- é€‰æ‹©æ–‡ä»¶åŒº -->
  <view class="upload-section" wx:if="{{!pdfFile}}">
    <view class="upload-box" bindtap="choosePDF">
      <text class="upload-icon">âœ‚ï¸</text>
      <text class="upload-text">é€‰æ‹©PDFæ–‡ä»¶</text>
      <text class="upload-hint">ç‚¹å‡»é€‰æ‹©è¦æ‹†åˆ†çš„PDF</text>
      <text class="upload-hint">æ–‡ä»¶å¤§å°ä¸è¶…è¿‡100MB</text>
    </view>
  </view>

  <!-- PDFæ–‡ä»¶ä¿¡æ¯ -->
  <view class="file-section" wx:if="{{pdfFile}}">
    <view class="file-card">
      <view class="file-header">
        <text class="file-icon">ğŸ“„</text>
        <view class="file-info">
          <text class="file-name">{{pdfFile.name}}</text>
          <text class="file-meta">{{utils.formatSize(pdfFile.size)}} | å…±{{pageCount}}é¡µ</text>
        </view>
        <view class="file-actions">
          <view class="action-btn change-btn" bindtap="choosePDF">
            <text>æ›´æ¢</text>
          </view>
          <view class="action-btn delete-btn" bindtap="deletePDF">
            <text>âœ•</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- æ‹†åˆ†æ¨¡å¼é€‰æ‹© -->
  <view class="mode-section" wx:if="{{pdfFile}}">
    <view class="section-title">ğŸ“‹ æ‹†åˆ†æ¨¡å¼</view>
    <radio-group class="mode-group" bindchange="onModeChange">
      <label class="mode-item {{splitMode === item.value ? 'active' : ''}}"
             wx:for="{{modeOptions}}" wx:key="value">
        <radio value="{{item.value}}" checked="{{splitMode === item.value}}" color="#16a34a"/>
        <text class="mode-icon">{{item.icon}}</text>
        <text class="mode-label">{{item.label}}</text>
      </label>
    </radio-group>
  </view>

  <!-- èŒƒå›´æ‹†åˆ†è®¾ç½® -->
  <view class="split-section" wx:if="{{pdfFile && splitMode === 'range'}}">
    <view class="section-title">ğŸ¯ è®¾ç½®æ‹†åˆ†èŒƒå›´</view>

    <!-- é¡µç è¾“å…¥ -->
    <view class="range-input-box">
      <view class="input-group">
        <text class="input-label">èµ·å§‹é¡µ</text>
        <input class="page-input"
               type="number"
               value="{{startPage}}"
               bindinput="onStartPageInput"
               placeholder="1"/>
      </view>
      <text class="range-separator">-</text>
      <view class="input-group">
        <text class="input-label">ç»“æŸé¡µ</text>
        <input class="page-input"
               type="number"
               value="{{endPage}}"
               bindinput="onEndPageInput"
               placeholder="{{pageCount}}"/>
      </view>
      <button class="add-btn" bindtap="addRange">æ·»åŠ </button>
    </view>

    <!-- èŒƒå›´åˆ—è¡¨ -->
    <view class="ranges-list" wx:if="{{ranges.length > 0}}">
      <view class="list-header">
        <text class="list-title">å·²æ·»åŠ èŒƒå›´ ({{ranges.length}})</text>
        <text class="clear-btn" bindtap="clearRanges">æ¸…ç©º</text>
      </view>

      <view class="range-item" wx:for="{{ranges}}" wx:key="id">
        <view class="range-badge">{{index + 1}}</view>
        <text class="range-text">{{item.name}}</text>
        <view class="range-delete" bindtap="deleteRange" data-id="{{item.id}}">
          <text>âœ•</text>
        </view>
      </view>
    </view>

    <view class="empty-tip" wx:if="{{ranges.length === 0}}">
      <text>è¿˜æœªæ·»åŠ æ‹†åˆ†èŒƒå›´ï¼Œè¯·è¾“å…¥é¡µç åç‚¹å‡»"æ·»åŠ "</text>
    </view>
  </view>

  <!-- å•é¡µæ‹†åˆ†è¯´æ˜ -->
  <view class="info-section" wx:if="{{pdfFile && splitMode === 'single'}}">
    <view class="info-card">
      <text class="info-icon">â„¹ï¸</text>
      <view class="info-content">
        <text class="info-title">å•é¡µæ‹†åˆ†æ¨¡å¼</text>
        <text class="info-desc">å°†PDFçš„æ¯ä¸€é¡µç‹¬ç«‹ä¿å­˜ä¸ºä¸€ä¸ªæ–‡ä»¶</text>
        <text class="info-detail">å°†ç”Ÿæˆ {{pageCount}} ä¸ªPDFæ–‡ä»¶</text>
      </view>
    </view>
  </view>

  <!-- å¹³å‡æ‹†åˆ†è®¾ç½® -->
  <view class="split-section" wx:if="{{pdfFile && splitMode === 'average'}}">
    <view class="section-title">âš–ï¸ å¹³å‡æ‹†åˆ†è®¾ç½®</view>

    <view class="average-box">
      <text class="average-label">æ‹†åˆ†æˆå‡ ä»½ï¼š</text>
      <slider class="average-slider"
              min="2" max="{{pageCount}}"
              value="{{splitCount}}"
              bindchange="onSplitCountChange"
              activeColor="#16a34a"
              backgroundColor="#e5e7eb"
              show-value
              block-size="20"/>
    </view>

    <view class="average-preview">
      <text class="preview-label">é¢„è®¡æ•ˆæœï¼š</text>
      <text class="preview-text">æ¯ä»½çº¦ {{Math.ceil(pageCount / splitCount)}} é¡µ</text>
    </view>
  </view>

  <!-- å¥‡å¶æ‹†åˆ†è®¾ç½® -->
  <view class="split-section" wx:if="{{pdfFile && splitMode === 'oddeven'}}">
    <view class="section-title">ğŸ”€ å¥‡å¶é¡µæ‹†åˆ†</view>

    <radio-group class="oddeven-group" bindchange="onOddEvenChange">
      <label class="oddeven-item">
        <radio value="odd" checked="{{oddEvenMode === 'odd'}}" color="#16a34a"/>
        <text class="oddeven-label">æå–å¥‡æ•°é¡µ (1, 3, 5...)</text>
      </label>
      <label class="oddeven-item">
        <radio value="even" checked="{{oddEvenMode === 'even'}}" color="#16a34a"/>
        <text class="oddeven-label">æå–å¶æ•°é¡µ (2, 4, 6...)</text>
      </label>
    </radio-group>

    <view class="oddeven-preview">
      <text class="preview-text">å°†æå– {{oddEvenMode === 'odd' ? Math.ceil(pageCount / 2) : Math.floor(pageCount / 2)}} é¡µ</text>
    </view>
  </view>

  <!-- æ‹†åˆ†æŒ‰é’® -->
  <view class="action-section" wx:if="{{pdfFile}}">
    <button class="split-btn"
            bindtap="startSplit"
            disabled="{{isProcessing}}"
            loading="{{isProcessing}}">
      {{isProcessing ? 'æ‹†åˆ†ä¸­...' : 'å¼€å§‹æ‹†åˆ†'}}
    </button>
  </view>

  <!-- ç»“æœåŒºåŸŸ -->
  <view class="result-section" wx:if="{{resultFiles.length > 0}}">
    <view class="section-title">âœ… æ‹†åˆ†å®Œæˆ</view>

    <view class="result-card">
      <view class="result-header">
        <text class="result-icon">ğŸ“¦</text>
        <text class="result-title">å·²ç”Ÿæˆ {{resultFiles.length}} ä¸ªæ–‡ä»¶</text>
      </view>

      <view class="result-list">
        <view class="result-item" wx:for="{{resultFiles}}" wx:key="index">
          <view class="result-index">{{index + 1}}</view>
          <view class="result-info">
            <text class="result-name">{{item.name}}</text>
            <text class="result-range">{{item.pageRange}}</text>
          </view>
          <button class="download-btn" bindtap="downloadFile" data-index="{{index}}">
            æ‰“å¼€
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!pdfFile}}">
    <text class="empty-icon">âœ‚ï¸</text>
    <text class="empty-text">è¿˜æ²¡æœ‰é€‰æ‹©æ–‡ä»¶</text>
    <text class="empty-hint">ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®é€‰æ‹©PDFæ–‡ä»¶</text>
  </view>

  <!-- ä½¿ç”¨è¯´æ˜ -->
  <view class="guide-section" wx:if="{{!pdfFile}}">
    <view class="guide-title">ğŸ“– æ‹†åˆ†æ¨¡å¼è¯´æ˜</view>

    <view class="guide-item">
      <text class="guide-icon">ğŸ“‘</text>
      <view class="guide-content">
        <text class="guide-label">èŒƒå›´æ‹†åˆ†</text>
        <text class="guide-desc">è‡ªå®šä¹‰å¤šä¸ªé¡µç èŒƒå›´ï¼Œçµæ´»æ‹†åˆ†</text>
      </view>
    </view>

    <view class="guide-item">
      <text class="guide-icon">ğŸ“„</text>
      <view class="guide-content">
        <text class="guide-label">å•é¡µæ‹†åˆ†</text>
        <text class="guide-desc">æ¯ä¸€é¡µç‹¬ç«‹ä¿å­˜ï¼Œé€‚åˆæå–ç‰¹å®šé¡µ</text>
      </view>
    </view>

    <view class="guide-item">
      <text class="guide-icon">âš–ï¸</text>
      <view class="guide-content">
        <text class="guide-label">å¹³å‡æ‹†åˆ†</text>
        <text class="guide-desc">è‡ªåŠ¨å¹³å‡åˆ†æˆNä»½ï¼Œé¡µæ•°å‡åŒ€åˆ†é…</text>
      </view>
    </view>

    <view class="guide-item">
      <text class="guide-icon">ğŸ”€</text>
      <view class="guide-content">
        <text class="guide-label">å¥‡å¶æ‹†åˆ†</text>
        <text class="guide-desc">åˆ†åˆ«æå–å¥‡æ•°é¡µæˆ–å¶æ•°é¡µ</text>
      </view>
    </view>
  </view>

</view>
