<!--pages/tools/id-photo-resize/index.wxml-->
<wxs module="utils">
var formatFileSize = function(bytes) {
  if (!bytes) return '0 B';
  if (bytes < 1024) {
    return bytes + ' B';
  } else if (bytes < 1024 * 1024) {
    return (bytes / 1024).toFixed(2) + ' KB';
  } else {
    return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
  }
};

module.exports = {
  formatFileSize: formatFileSize
};
</wxs>

<view class="container">
  <!-- é¡¶éƒ¨æ“ä½œåŒº -->
  <view class="action-section">
    <button class="choose-btn" bindtap="chooseImage">
      <text class="icon">ğŸ“·</text>
      <text>é€‰æ‹©ç…§ç‰‡</text>
    </button>
  </view>

  <!-- å›¾ç‰‡é¢„è§ˆåŒº -->
  <view class="preview-section" wx:if="{{hasImage}}">
    <view class="preview-title">ğŸ“¸ å›¾ç‰‡é¢„è§ˆ</view>
    
    <view class="image-preview-container">
      <!-- åŸå§‹å›¾ç‰‡ -->
      <view class="preview-item">
        <view class="preview-label">åŸå§‹ç…§ç‰‡</view>
        <image 
          class="preview-image" 
          src="{{originalImage}}" 
          mode="aspectFit"
          bindtap="previewImage"
          data-src="{{originalImage}}"
        />
        <view class="preview-info">
          <text>{{imageInfo.width}} Ã— {{imageInfo.height}}</text>
          <text>{{utils.formatFileSize(originalSize)}}</text>
        </view>
      </view>

      <!-- å¤„ç†åå›¾ç‰‡ -->
      <view class="preview-item" wx:if="{{processedImage}}">
        <view class="preview-label">å¤„ç†å</view>
        <image 
          class="preview-image processed" 
          src="{{processedImage}}" 
          mode="aspectFit"
          bindtap="previewImage"
          data-src="{{processedImage}}"
        />
        <view class="preview-info">
          <text>{{currentSpecWidth}} Ã— {{currentSpecHeight}}</text>
          <text>{{utils.formatFileSize(processedSize)}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- è®¾ç½®åŒºåŸŸ -->
  <view class="settings-section">
    <view class="section-title">âš™ï¸ è¯ä»¶ç…§è®¾ç½®</view>

    <!-- ç…§ç‰‡è§„æ ¼é€‰æ‹© -->
    <view class="setting-item">
      <view class="setting-label">
        <text class="label-icon">ğŸ“</text>
        <text class="label-text">ç…§ç‰‡è§„æ ¼</text>
      </view>
      <picker 
        mode="selector" 
        range="{{photoSpecs}}" 
        range-key="name"
        value="{{selectedSpecIndex}}"
        bindchange="onSpecChange"
      >
        <view class="picker">
          <text class="picker-icon">{{photoSpecs[selectedSpecIndex].icon}}</text>
          <text class="picker-text">{{photoSpecs[selectedSpecIndex].name}}</text>
          <text class="picker-desc">{{photoSpecs[selectedSpecIndex].description}}</text>
          <text class="picker-arrow">â€º</text>
        </view>
      </picker>
    </view>

    <!-- è‡ªå®šä¹‰å°ºå¯¸è¾“å…¥ -->
    <view class="custom-size-section" wx:if="{{showCustomInput}}">
      <view class="custom-input-row">
        <view class="custom-input-item">
          <text class="custom-label">å®½åº¦(mm)</text>
          <input 
            type="digit" 
            class="custom-input" 
            value="{{customWidth}}"
            bindinput="onCustomWidthInput"
            placeholder="35"
          />
        </view>
        <text class="custom-separator">Ã—</text>
        <view class="custom-input-item">
          <text class="custom-label">é«˜åº¦(mm)</text>
          <input 
            type="digit" 
            class="custom-input" 
            value="{{customHeight}}"
            bindinput="onCustomHeightInput"
            placeholder="45"
          />
        </view>
      </view>
      <button class="apply-btn" size="mini" bindtap="applyCustomSize">åº”ç”¨è‡ªå®šä¹‰å°ºå¯¸</button>
    </view>

    <!-- è§„æ ¼ä¿¡æ¯æ˜¾ç¤º -->
    <view class="spec-info" wx:if="{{!showCustomInput}}">
      <text class="spec-text">
        å°ºå¯¸: {{photoSpecs[selectedSpecIndex].widthMM}}mm Ã— {{photoSpecs[selectedSpecIndex].heightMM}}mm
      </text>
      <text class="spec-text pixel-info">
        åƒç´ : {{currentSpecWidth}} Ã— {{currentSpecHeight}}
      </text>
    </view>

    <!-- èƒŒæ™¯é¢œè‰²é€‰æ‹© -->
    <view class="setting-item">
      <view class="setting-label">
        <text class="label-icon">ğŸ¨</text>
        <text class="label-text">èƒŒæ™¯é¢œè‰²</text>
      </view>
      <picker 
        mode="selector" 
        range="{{backgroundColors}}" 
        range-key="name"
        value="{{selectedBackgroundIndex}}"
        bindchange="onBackgroundChange"
      >
        <view class="picker">
          <text class="picker-icon">{{backgroundColors[selectedBackgroundIndex].icon}}</text>
          <text class="picker-text">{{backgroundColors[selectedBackgroundIndex].name}}</text>
          <view 
            class="color-preview" 
            wx:if="{{backgroundColors[selectedBackgroundIndex].color}}"
            style="background-color: {{backgroundColors[selectedBackgroundIndex].color}}"
          ></view>
          <text class="picker-arrow">â€º</text>
        </view>
      </picker>
    </view>

    <!-- DPIé€‰æ‹© -->
    <view class="setting-item">
      <view class="setting-label">
        <text class="label-icon">ğŸ”</text>
        <text class="label-text">åˆ†è¾¨ç‡</text>
      </view>
      <picker 
        mode="selector" 
        range="{{dpiOptions}}" 
        range-key="name"
        value="{{selectedDpiIndex}}"
        bindchange="onDpiChange"
      >
        <view class="picker">
          <text class="picker-text">{{dpiOptions[selectedDpiIndex].name}}</text>
          <text class="picker-desc">{{dpiOptions[selectedDpiIndex].description}}</text>
          <text class="picker-arrow">â€º</text>
        </view>
      </picker>
    </view>

    <!-- å›¾ç‰‡è´¨é‡é€‰æ‹© -->
    <view class="setting-item">
      <view class="setting-label">
        <text class="label-icon">âœ¨</text>
        <text class="label-text">è¾“å‡ºè´¨é‡</text>
      </view>
      <picker 
        mode="selector" 
        range="{{qualityOptions}}" 
        range-key="name"
        value="{{selectedQualityIndex}}"
        bindchange="onQualityChange"
      >
        <view class="picker">
          <text class="picker-text">{{qualityOptions[selectedQualityIndex].name}}</text>
          <text class="picker-arrow">â€º</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- æ“ä½œæŒ‰é’® -->
  <view class="button-section" wx:if="{{hasImage}}">
    <button 
      class="process-btn" 
      bindtap="processImage"
      disabled="{{isProcessing}}"
      loading="{{isProcessing}}"
    >
      <text class="btn-icon">ğŸ”„</text>
      <text>{{isProcessing ? 'å¤„ç†ä¸­...' : 'é‡æ–°å¤„ç†'}}</text>
    </button>

    <button 
      class="save-btn" 
      bindtap="saveImage"
      disabled="{{!processedImage || isProcessing}}"
    >
      <text class="btn-icon">ğŸ’¾</text>
      <text>ä¿å­˜åˆ°ç›¸å†Œ</text>
    </button>

    <button 
      class="reselect-btn" 
      bindtap="reselect"
      disabled="{{isProcessing}}"
    >
      <text class="btn-icon">ğŸ”„</text>
      <text>é‡æ–°é€‰æ‹©</text>
    </button>
  </view>

  <!-- ä½¿ç”¨è¯´æ˜ -->
  <view class="tips-section" wx:if="{{!hasImage}}">
    <view class="tips-title">ğŸ“– ä½¿ç”¨è¯´æ˜</view>
    <view class="tips-content">
      <view class="tip-item">
        <text class="tip-number">1</text>
        <text class="tip-text">ç‚¹å‡»"é€‰æ‹©ç…§ç‰‡"æŒ‰é’®ï¼Œä»ç›¸å†Œé€‰æ‹©æˆ–æ‹æ‘„ç…§ç‰‡</text>
      </view>
      <view class="tip-item">
        <text class="tip-number">2</text>
        <text class="tip-text">é€‰æ‹©éœ€è¦çš„è¯ä»¶ç…§è§„æ ¼ï¼ˆ1å¯¸ã€2å¯¸ã€æŠ¤ç…§ç­‰ï¼‰</text>
      </view>
      <view class="tip-item">
        <text class="tip-number">3</text>
        <text class="tip-text">é€‰æ‹©èƒŒæ™¯é¢œè‰²ï¼ˆå¯é€‰ï¼‰ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨è°ƒæ•´</text>
      </view>
      <view class="tip-item">
        <text class="tip-number">4</text>
        <text class="tip-text">é¢„è§ˆæ•ˆæœåï¼Œä¿å­˜åˆ°ç›¸å†Œå³å¯ä½¿ç”¨</text>
      </view>
    </view>

    <view class="tips-note">
      <text class="note-icon">ğŸ’¡</text>
      <text class="note-text">æç¤ºï¼šå»ºè®®ä½¿ç”¨æ­£é¢ç…§ç‰‡ï¼Œäººåƒå±…ä¸­æ•ˆæœæ›´å¥½</text>
    </view>
  </view>

  <!-- åº•éƒ¨è¯´æ˜ -->
  <view class="footer">
    <text class="footer-text">æ”¯æŒå¤šç§æ ‡å‡†è¯ä»¶ç…§è§„æ ¼</text>
  </view>
</view>
