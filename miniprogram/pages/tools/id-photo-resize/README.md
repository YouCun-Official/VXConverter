# 证件照调尺寸功能

## 📝 功能说明

这是一个为微信小程序开发的证件照尺寸调整工具，可以快速将照片调整为标准证件照规格。

## ✨ 功能特点

### 1. 支持多种标准规格
- **1寸照片** (25×35mm) - 常用于简历、证件
- **小1寸照片** (22×32mm) - 驾驶证、身份证等
- **2寸照片** (35×45mm) - 护照、签证等
- **小2寸照片** (35×49mm) - 护照等
- **身份证照片** (26×32mm)
- **中国护照** (33×48mm)
- **国际护照** (35×45mm)
- **驾驶证** (22×32mm)
- **社保卡** (26×32mm)
- **美国签证** (51×51mm)
- **自定义尺寸** - 可输入任意尺寸

### 2. 背景色替换
- 保持原背景
- 白色背景
- 红色背景
- 蓝色背景
- 浅蓝色背景

### 3. 分辨率选项
- 标准 (300 DPI) - 适合打印
- 高清 (600 DPI) - 高质量打印
- 网络 (150 DPI) - 适合网络上传

### 4. 图片质量
- 高质量 (100%)
- 中等 (90%)
- 低质量 (80%)

## 📂 文件结构

```
miniprogram/pages/tools/id-photo-resize/
├── config.js          # 证件照规格配置
├── index.js           # 页面逻辑
├── index.json         # 页面配置
├── index.wxml         # 页面结构
└── index.wxss         # 页面样式
```

## 🔧 技术实现

### 核心技术
- **Canvas API** - 用于图片处理和裁剪
- **wx.chooseImage** - 选择/拍摄照片
- **OffscreenCanvas** - 离屏Canvas提高性能
- **智能裁剪算法** - 自动居中裁剪保持最佳效果

### 处理流程
1. 用户选择照片
2. 获取图片信息（宽高、文件大小）
3. 根据选择的规格计算目标尺寸
4. 使用Canvas进行智能裁剪
5. 应用背景色（如果选择）
6. 导出处理后的图片
7. 保存到相册

### 智能裁剪算法
```javascript
// 计算裁剪区域，保持人像居中
const imageRatio = width / height;
const targetRatio = targetWidth / targetHeight;

if (imageRatio > targetRatio) {
  // 图片更宽，裁剪左右
  sourceHeight = imageHeight;
  sourceWidth = sourceHeight * targetRatio;
  sourceX = (imageWidth - sourceWidth) / 2;
  sourceY = 0;
} else {
  // 图片更高，裁剪上下
  sourceWidth = imageWidth;
  sourceHeight = sourceWidth / targetRatio;
  sourceX = 0;
  sourceY = (imageHeight - sourceHeight) / 2;
}
```

## 🚀 使用方法

### 用户操作步骤
1. 点击"选择照片"按钮
2. 从相册选择或拍摄照片
3. 选择需要的证件照规格
4. （可选）选择背景颜色
5. （可选）调整分辨率和质量
6. 预览效果
7. 点击"保存到相册"

### 开发者集成
1. 确保页面路径已添加到 `app.json`
2. 在需要的地方调用导航：
```javascript
wx.navigateTo({
  url: '/pages/tools/id-photo-resize/index'
});
```

## 📱 测试建议

### 功能测试
- [ ] 测试选择照片（相册和拍照）
- [ ] 测试各种证件照规格切换
- [ ] 测试背景色替换效果
- [ ] 测试自定义尺寸输入
- [ ] 测试不同DPI和质量设置
- [ ] 测试保存到相册功能
- [ ] 测试权限授权流程

### 兼容性测试
- [ ] 测试不同尺寸的照片（横向、纵向、方形）
- [ ] 测试不同格式（JPG、PNG）
- [ ] 测试大文件（>5MB）
- [ ] 测试小文件（<100KB）

### 边界测试
- [ ] 测试极小尺寸照片
- [ ] 测试极大尺寸照片
- [ ] 测试自定义尺寸边界值
- [ ] 测试网络异常情况

## 🎨 UI/UX 特点

- **渐变背景** - 紫色渐变增强视觉效果
- **卡片设计** - 圆角卡片提升现代感
- **图标辅助** - Emoji图标增强可读性
- **实时预览** - 对比原图和处理后效果
- **响应式反馈** - Loading状态和Toast提示
- **使用说明** - 首次使用有详细引导

## 📊 性能优化

- 使用 `OffscreenCanvas` 提高处理速度
- 异步处理避免阻塞UI
- 图片压缩减小文件大小
- 智能缓存减少重复处理

## 🔐 权限说明

需要的小程序权限：
- `scope.camera` - 拍照功能
- `scope.album` - 访问相册
- `scope.writePhotosAlbum` - 保存图片到相册

## 🐛 已知问题

暂无

## 🔄 未来优化方向

1. **AI抠图** - 集成AI自动抠图功能，自动替换背景
2. **美颜功能** - 添加基础美颜和磨皮功能
3. **批量处理** - 支持同时处理多张照片
4. **打印尺寸预览** - 显示实际打印尺寸预览
5. **云端处理** - 将复杂处理迁移到云函数
6. **模板保存** - 保存常用设置为模板
7. **裁剪框调整** - 手动调整裁剪区域

## 📄 许可证

与主项目保持一致

## 👥 贡献者

GitHub Copilot (Claude Sonnet 4.5)

---

**最后更新**: 2026年2月16日
