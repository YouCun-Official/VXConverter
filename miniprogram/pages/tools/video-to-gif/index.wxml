<view class="container">
  <view class="upload-section" wx:if="{{videos.length === 0}}">
    <view class="upload-box" bindtap="chooseVideos">
      <text class="upload-icon">ğŸï¸</text>
      <text class="upload-text">é€‰æ‹©è§†é¢‘</text>
      <text class="upload-hint">æ”¯æŒMP4ã€MOVç­‰æ ¼å¼ï¼Œè½¬æ¢ä¸ºGIFåŠ¨å›¾</text>
    </view>
  </view>

  <view class="videos-section" wx:if="{{videos.length > 0}}">
    <view class="section-header">
       <text class="section-title">å·²é€‰è§†é¢‘</text>
       <text class="clear-btn" bindtap="deleteVideo" wx:if="{{!isConverting && !videos[0].convertedFileID}}">é‡é€‰</text>
    </view>
    
    <view class="video-list">
      <view class="video-item" wx:for="{{videos}}" wx:key="index">
         <view class="video-preview">
            <text class="video-icon">ğŸ¬</text>
            <text class="video-badge">{{item.durationText}}</text>
         </view>
         <view class="video-info">
            <view class="info-row"><text class="info-label">å¤§å°:</text><text class="info-value">{{utils.formatSize(item.originalSize)}}</text></view>
            <view class="info-row" wx:if="{{item.convertedFileID}}">
                <text class="info-label success">æˆåŠŸ:</text>
                <text class="info-value">{{utils.formatSize(item.convertedSize)}} (GIF)</text>
            </view>
         </view>
      </view>
    </view>
  </view>

  <view class="settings-section" wx:if="{{videos.length > 0 && !videos[0].convertedFileID}}">
       <view class="setting-item">
      <text class="setting-label">åˆ†è¾¨ç‡</text>
      <picker class="setting-picker" mode="selector"
              range="{{resolutionOptions}}" range-key="label"
              value="{{resolutionIndex}}"
              bindchange="onResolutionChange">
        <view class="picker-display">
          <text>{{resolutionOptions[resolutionIndex].label}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
    </view>
    
    <view class="setting-item">
      <text class="setting-label">å¸§ç‡ (FPS)</text>
      <picker class="setting-picker" mode="selector"
              range="{{fpsOptions}}" range-key="label"
              value="{{fpsIndex}}"
              bindchange="onFpsChange">
        <view class="picker-display">
          <text>{{fpsOptions[fpsIndex].label}}</text>
          <text class="picker-arrow">â–¼</text>
        </view>
      </picker>
    </view>
  </view>

  <view class="action-section" wx:if="{{videos.length > 0}}">
      <button class="convert-btn" bindtap="startConvert" loading="{{isConverting}}" disabled="{{isConverting}}" wx:if="{{!videos[0].convertedFileID}}">
        {{isConverting ? 'æ­£åœ¨è½¬æ¢...' : 'å¼€å§‹è½¬æ¢GIF'}}
      </button>
      
      <button class="save-all-btn" bindtap="saveSingleVideo" wx:if="{{videos[0].convertedFileID}}" style="background: #16a34a;">
        ä¿å­˜GIF
      </button>

      <button class="clear-btn" style="width:100%; margin-top:20rpx; background:#f3f4f6; color:#666;" bindtap="deleteVideo" wx:if="{{videos[0].convertedFileID}}">
        è½¬æ¢ä¸‹ä¸€ä¸ª
      </button>
  </view>
</view>

<wxs module="utils">
  var formatSize = function(size) {
    if (size < 1024) return size + 'B';
    if (size < 1024 * 1024) return (size / 1024).toFixed(2) + 'KB';
    return (size / 1024 / 1024).toFixed(2) + 'MB';
  };
  module.exports = {
    formatSize: formatSize
  };
</wxs>